---
title: "`rdf4jr` Package Example 1"
author: "Viktor Senderov"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup}
library(XML)
library(rdf4jr)
```

## `rdf4jr` package documentation

`rdf4jr` is an R-package for working with (RDFJ4J)[http://rdf4j.org/] REST API's for the purposes of accessing RDF graph databases.

## Initializing a database options file

The first step when working with the package is to create an `options` list, which contains endpoint and access information. Here, we use an access point provided by (Ontotext's S4 cloud storage service)[http://s4.ontotext.com/]. In order, to create the `options` list, one needs to use the `create_server_options` function:

```{r options}
options = create_server_options(protocol = "https://", server_add = "rdf.s4.ontotext.com/4937448214/OBKMS", authentication = "api", api_key = "s4i0k6o7v6l0", secret = "9k03ah49e3da607"  )

eucases_secret = read.table( file = "./secrets/eucases.txt", header = TRUE , stringsAsFactors = FALSE)
options2 = create_server_options(protocol = eucases_secret[1, "protocol"], server_add = eucases_secret[1, "server_add"], authentication = eucases_secret[1, "authentication"], userpwd = eucases_secret[1, "userpwd"])
```

## Quering for the protocol version

You can also embed plots, for example:

```{r protocol}
get_protocol_version(options)
```

## Quering the list of repositories found at the server

```{r repo_list}
get_repositories( options )
```

## Defining a sample SPARQL query

This query counts the number of triples in the graph:

```{r query}
query = "SELECT (COUNT(*) as ?count)
FROM <http://www.ontotext.com/implicit>
WHERE {
   ?s ?p ?o .
}"


```

## Submitting a query via GET

Getting the results back as a data frame:

```{r get_query_data_frame}
GET_query( options, "plazi", query, "CSV" )
```

Getting the results back as XML:

```{r get_query_xml}
GET_query( options, "plazi", query, "XML" )
```

## Submitting a query via POST

Getting the results back as a data frame:

```{r post_query_data_frame}
POST_query( options, "plazi", query, "CSV" )
```

Getting the results back as XML:

```{r post_query_xml}
POST_query( options, "plazi", query, "XML" )
```
